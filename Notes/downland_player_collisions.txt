Player collisions with objects (drops, ball, bird, treasure)

At the rom location 0xde17 (Player_CollisionMasks_0xde17 in the Ghidra listing), there is a series of "mysterious sprites" that are between the player sprites and the bouncy ball sprites. These aren't sprites but actually masks. For every player sprite, each mask is made up of five horizontal line masks. The lines are applied on the player sprite starting from the second row and then every third line. For every mask line, the player sprite's pixels on the game screen are copied into a buffer. Then the lines in the buffer are compared with a clean version of the player sprite. The clean version also includes the background. If there are any differences between the player sprite extracted from the screen and the clean version, then that means the player is overlapping with something. The code then jumps to a function that tests box-box collisions with every game object (treasure, ball, drop, bird)

"collision mask handling.png" shows how the collision mask lines are used. The first two sprites are examples of the player sprite overlapping with the ball sprite. The collision function goes across those rows, the masks defining which pixels should be checked. The pixels from the mask are extracted and stored in a buffer. Then the stored masks are compared against the clean version of the sprite. If there are any differences, then a collision has occured.